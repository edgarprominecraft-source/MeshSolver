<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Mesh Solver - –†–µ—à–∞—Ç–µ–ª—å –¶–î–ó</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            font-family: 'Arial', sans-serif;
        }
        
        :root {
            --primary-color: #667eea;
            --secondary-color: #764ba2;
            --bg-color: white;
            --text-color: #333;
            --border-color: #ddd;
            --message-bg: #f8f9fa;
            --container-width: 400px;
            --button-size: 16px;
            --button-padding: 15px;
        }
        
        body.dark-theme {
            --primary-color: #4a5568;
            --secondary-color: #2d3748;
            --bg-color: #1a202c;
            --text-color: white;
            --border-color: #4a5568;
            --message-bg: #2d3748;
        }
        
        body.blue-theme {
            --primary-color: #4facfe;
            --secondary-color: #00f2fe;
        }
        
        body.green-theme {
            --primary-color: #43e97b;
            --secondary-color: #38f9d7;
        }
        
        body.red-theme {
            --primary-color: #fa709a;
            --secondary-color: #fee140;
        }
        
        body {
            background: linear-gradient(135deg, var(--primary-color) 0%, var(--secondary-color) 100%);
            min-height: 100vh;
            padding: 20px;
            color: var(--text-color);
            transition: all 0.3s ease;
        }
        
        .container {
            max-width: var(--container-width);
            margin: 0 auto;
            background: var(--bg-color);
            border-radius: 15px;
            padding: 20px;
            box-shadow: 0 10px 30px rgba(0,0,0,0.3);
            transition: all 0.3s ease;
        }
        
        .header {
            text-align: center;
            margin-bottom: 20px;
        }
        
        .header h1 {
            color: var(--text-color);
            font-size: 24px;
            margin-bottom: 5px;
        }
        
        .header .version {
            color: #666;
            font-size: 14px;
        }
        
        .screen {
            display: none;
        }
        
        .active {
            display: block;
        }
        
        .btn {
            width: 100%;
            padding: var(--button-padding);
            margin: 10px 0;
            border: none;
            border-radius: 10px;
            background: var(--primary-color);
            color: white;
            font-size: var(--button-size);
            cursor: pointer;
            transition: 0.3s;
        }
        
        .btn:hover {
            background: var(--secondary-color);
            transform: translateY(-2px);
        }
        
        .btn-admin {
            background: #ff6b6b;
        }
        
        .btn-premium {
            background: #ffa726;
        }
        
        .input-field {
            width: 100%;
            padding: var(--button-padding);
            margin: 10px 0;
            border: 2px solid var(--border-color);
            border-radius: 10px;
            font-size: var(--button-size);
            background: var(--bg-color);
            color: var(--text-color);
        }
        
        .message {
            padding: 15px;
            margin: 10px 0;
            border-radius: 10px;
            background: var(--message-bg);
            border-left: 4px solid var(--primary-color);
            color: var(--text-color);
        }
        
        .ai-message {
            background: #e3f2fd;
            border-left: 4px solid #2196f3;
        }
        
        .dark-theme .ai-message {
            background: #2d3748;
        }
        
        .user-message {
            background: #f3e5f5;
            border-left: 4px solid #9c27b0;
            text-align: right;
        }
        
        .dark-theme .user-message {
            background: #4a5568;
        }
        
        .chat-container {
            height: 300px;
            overflow-y: auto;
            border: 1px solid var(--border-color);
            border-radius: 10px;
            padding: 10px;
            margin: 10px 0;
        }
        
        .admin-panel {
            background: #fff3e0;
            border: 2px solid #ffa726;
            border-radius: 10px;
            padding: 15px;
            margin: 10px 0;
        }
        
        .dark-theme .admin-panel {
            background: #2d3748;
            border-color: #ffa726;
        }
        
        .user-list {
            max-height: 200px;
            overflow-y: auto;
            margin: 10px 0;
        }
        
        .user-item {
            padding: 10px;
            border-bottom: 1px solid var(--border-color);
            display: flex;
            justify-content: space-between;
            align-items: center;
        }
        
        .setting-item {
            margin: 15px 0;
            padding: 10px;
            background: var(--message-bg);
            border-radius: 10px;
        }
        
        .setting-label {
            display: block;
            margin-bottom: 10px;
            font-weight: bold;
            color: var(--text-color);
        }
        
        .slider {
            width: 100%;
            height: 10px;
            border-radius: 5px;
            background: #ddd;
            outline: none;
            margin: 10px 0;
        }
        
        .toggle-switch {
            position: relative;
            display: inline-block;
            width: 60px;
            height: 34px;
        }
        
        .toggle-switch input {
            opacity: 0;
            width: 0;
            height: 0;
        }
        
        .slider-toggle {
            position: absolute;
            cursor: pointer;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background-color: #ccc;
            transition: .4s;
            border-radius: 34px;
        }
        
        .slider-toggle:before {
            position: absolute;
            content: "";
            height: 26px;
            width: 26px;
            left: 4px;
            bottom: 4px;
            background-color: white;
            transition: .4s;
            border-radius: 50%;
        }
        
        input:checked + .slider-toggle {
            background-color: var(--primary-color);
        }
        
        input:checked + .slider-toggle:before {
            transform: translateX(26px);
        }
        
        .size-display {
            text-align: center;
            font-weight: bold;
            margin: 10px 0;
            color: var(--text-color);
        }
    </style>
</head>
<body>
    <div class="container">
        <!-- –≠–∫—Ä–∞–Ω –ø—Ä–∏–≤–µ—Ç—Å—Ç–≤–∏—è -->
        <div id="welcomeScreen" class="screen active">
            <div class="header">
                <h1>üß† Mesh Solver</h1>
                <div class="version">–í–µ—Ä—Å–∏—è 1.1.0</div>
            </div>
            
            <button class="btn" onclick="showScreen('loginScreen')">
                üì± –í–æ–π—Ç–∏ –ø–æ –∫–æ–¥—É
            </button>
            
            <button class="btn btn-admin" onclick="adminLogin()">
                üîß –†–µ–∂–∏–º —Ä–∞–∑—Ä–∞–±–æ—Ç—á–∏–∫–∞
            </button>
            
            <div class="message">
                <strong>–†–∞–∑—Ä–∞–±–æ—Ç—á–∏–∫:</strong> @razrab<br>
                –î–ª—è –æ–±—Ä–∞–∑–æ–≤–∞—Ç–µ–ª—å–Ω—ã—Ö —Ü–µ–ª–µ–π
            </div>
        </div>

        <!-- –≠–∫—Ä–∞–Ω –≤—Ö–æ–¥–∞ -->
        <div id="loginScreen" class="screen">
            <div class="header">
                <h2>üîê –í—Ö–æ–¥ –≤ —Å–∏—Å—Ç–µ–º—É</h2>
            </div>
            
            <input type="password" class="input-field" id="codeInput" placeholder="–í–≤–µ–¥–∏—Ç–µ –≤–∞—à –∫–æ–¥ –¥–æ—Å—Ç—É–ø–∞">
            
            <button class="btn" onclick="login()">
                –í–æ–π—Ç–∏
            </button>
            
            <div class="message">
                <strong>–ü—Ä–∞–≤–∏–ª–∞ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è:</strong><br>
                1. –ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ —Ç–æ–ª—å–∫–æ –≤ –æ–±—Ä–∞–∑–æ–≤–∞—Ç–µ–ª—å–Ω—ã—Ö —Ü–µ–ª—è—Ö<br>
                2. –ó–∞–ø—Ä–µ—â–µ–Ω–æ –Ω–∞—Ä—É—à–∞—Ç—å –∑–∞–∫–æ–Ω—ã –†–æ—Å—Å–∏–π—Å–∫–æ–π –§–µ–¥–µ—Ä–∞—Ü–∏–∏<br>
                3. –û—Ç–≤–µ—Ç—Å—Ç–≤–µ–Ω–Ω–æ—Å—Ç—å –∑–∞ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ –Ω–µ—Å–µ—Ç –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å<br>
                4. –†–∞–∑—Ä–∞–±–æ—Ç—á–∏–∫ –Ω–µ –Ω–µ—Å–µ—Ç –æ—Ç–≤–µ—Ç—Å—Ç–≤–µ–Ω–Ω–æ—Å—Ç–∏ –∑–∞ –ø–æ—Å–ª–µ–¥—Å—Ç–≤–∏—è
            </div>
            
            <button class="btn" onclick="showScreen('welcomeScreen')">
                ‚Üê –ù–∞–∑–∞–¥
            </button>
        </div>

        <!-- –ì–ª–∞–≤–Ω–æ–µ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ -->
        <div id="mainApp" class="screen">
            <div class="header">
                <h2>ü§ñ AI –ß–∞—Ç</h2>
                <div id="userInfo"></div>
            </div>
            
            <div class="chat-container" id="chatContainer">
                <div class="message ai-message">
                    <strong>AI:</strong> –ü—Ä–∏–≤–µ—Ç! –ü—Ä–∏—à–ª–∏ —Å—Å—ã–ª–∫—É –Ω–∞ –∑–∞–¥–∞–Ω–∏–µ –∏–∑ –ú–≠–®/–¶–î–ó –∏ —è –Ω–∞–π–¥—É –æ—Ç–≤–µ—Ç—ã!
                </div>
            </div>
            
            <input type="text" class="input-field" id="messageInput" placeholder="–í–≤–µ–¥–∏—Ç–µ —Å—Å—ã–ª–∫—É –Ω–∞ –∑–∞–¥–∞–Ω–∏–µ...">
            
            <button class="btn" onclick="sendMessage()">
                üì§ –û—Ç–ø—Ä–∞–≤–∏—Ç—å
            </button>
            
            <button class="btn" onclick="showScreen('profileScreen')">
                üë§ –ü—Ä–æ—Ñ–∏–ª—å
            </button>
            
            <button class="btn" onclick="showScreen('settingsScreen')">
                ‚öôÔ∏è –ù–∞—Å—Ç—Ä–æ–π–∫–∏
            </button>
            
            <button class="btn" onclick="logout()">
                üö™ –í—ã–π—Ç–∏
            </button>
        </div>

        <!-- –ü—Ä–æ—Ñ–∏–ª—å -->
        <div id="profileScreen" class="screen">
            <div class="header">
                <h2>üë§ –ü—Ä–æ—Ñ–∏–ª—å</h2>
            </div>
            
            <div class="message" id="profileInfo">
                <!-- –ò–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è –∑–∞–ø–æ–ª–Ω—è–µ—Ç—Å—è —á–µ—Ä–µ–∑ JavaScript -->
            </div>
            
            <button class="btn" onclick="showScreen('mainApp')">
                ‚Üê –ù–∞–∑–∞–¥ –∫ —á–∞—Ç—É
            </button>
        </div>

        <!-- –ù–∞—Å—Ç—Ä–æ–π–∫–∏ -->
        <div id="settingsScreen" class="screen">
            <div class="header">
                <h2>‚öôÔ∏è –ù–∞—Å—Ç—Ä–æ–π–∫–∏</h2>
            </div>
            
            <div class="message">
                <div class="setting-item">
                    <label class="setting-label">üåô –¢–µ–º–Ω–∞—è —Ç–µ–º–∞</label>
                    <label class="toggle-switch">
                        <input type="checkbox" id="darkThemeToggle" onchange="toggleDarkTheme()">
                        <span class="slider-toggle"></span>
                    </label>
                </div>
                
                <div class="setting-item">
                    <label class="setting-label">üìè –†–∞–∑–º–µ—Ä —Ç–µ–∫—Å—Ç–∞</label>
                    <input type="range" min="14" max="20" value="16" class="slider" id="fontSizeSlider" oninput="changeFontSize(this.value)">
                    <div class="size-display" id="fontSizeValue">–°—Ä–µ–¥–Ω–∏–π (16px)</div>
                </div>
                
                <div class="setting-item">
                    <label class="setting-label">üì± –†–∞–∑–º–µ—Ä –∫–Ω–æ–ø–æ–∫</label>
                    <input type="range" min="12" max="20" value="15" class="slider" id="buttonPaddingSlider" oninput="changeButtonPadding(this.value)">
                    <div class="size-display" id="buttonPaddingValue">–°—Ç–∞–Ω–¥–∞—Ä—Ç–Ω—ã–π (15px)</div>
                </div>
                
                <div class="setting-item">
                    <label class="setting-label">üé® –¶–≤–µ—Ç–æ–≤–∞—è —Ç–µ–º–∞</label>
                    <select class="input-field" id="themeColorSelect" onchange="changeThemeColor(this.value)">
                        <option value="default">–§–∏–æ–ª–µ—Ç–æ–≤—ã–π</option>
                        <option value="blue">–°–∏–Ω–∏–π</option>
                        <option value="green">–ó–µ–ª–µ–Ω—ã–π</option>
                        <option value="red">–ö—Ä–∞—Å–Ω—ã–π</option>
                    </select>
                </div>
                
                <div class="setting-item">
                    <label class="setting-label">üîî –£–≤–µ–¥–æ–º–ª–µ–Ω–∏—è</label>
                    <label class="toggle-switch">
                        <input type="checkbox" id="notificationsToggle" checked onchange="toggleNotifications()">
                        <span class="slider-toggle"></span>
                    </label>
                </div>
            </div>
            
            <button class="btn" onclick="showScreen('mainApp')">
                ‚Üê –ù–∞–∑–∞–¥
            </button>
        </div>

        <!-- –ê–¥–º–∏–Ω –ø–∞–Ω–µ–ª—å -->
        <div id="adminPanel" class="screen">
            <div class="header">
                <h2>üîß –ü–∞–Ω–µ–ª—å —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è</h2>
                <div class="version">–†–∞–∑—Ä–∞–±–æ—Ç—á–∏–∫: @razrab</div>
            </div>
            
            <div class="admin-panel">
                <h3>üìä –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ —Å–µ—Ä–≤–µ—Ä–∞</h3>
                <div id="serverStats">
                    <p>–ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π: <span id="totalUsers">0</span></p>
                    <p>–û–Ω–ª–∞–π–Ω: <span id="onlineUsers">0</span></p>
                    <p>–û—Ç–≤–µ—Ç–æ–≤ –≤—ã–¥–∞–Ω–æ: <span id="totalAnswers">0</span></p>
                    <p>–°—Ç–∞—Ç—É—Å: <span style="color: green;">üü¢ ONLINE</span></p>
                </div>
                
                <h3>üîë –°–µ–∫—Ä–µ—Ç–Ω—ã–µ –∫–æ–¥—ã –¥–æ—Å—Ç—É–ø–∞</h3>
                <div class="message">
                    <div id="secretCodes" style="max-height: 200px; overflow-y: auto;"></div>
                </div>
                
                <h3>üë• –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è–º–∏</h3>
                <div class="user-list" id="userList">
                    <!-- –°–ø–∏—Å–æ–∫ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π -->
                </div>
                
                <button class="btn btn-admin" onclick="generateNewCodes()">
                    üéÅ –°–≥–µ–Ω–µ—Ä–∏—Ä–æ–≤–∞—Ç—å –Ω–æ–≤—ã–µ –∫–æ–¥—ã
                </button>
                
                <button class="btn btn-premium" onclick="givePremium()">
                    üíé –í—ã–¥–∞—Ç—å –ø—Ä–µ–º–∏—É–º
                </button>
                
                <button class="btn" onclick="changeDeveloperPassword()">
                    üîê –°–º–µ–Ω–∏—Ç—å –ø–∞—Ä–æ–ª—å —Ä–∞–∑—Ä–∞–±–æ—Ç—á–∏–∫–∞
                </button>
            </div>
            
            <button class="btn" onclick="logout()">
                üö™ –í—ã–π—Ç–∏
            </button>
        </div>
    </div>

    <script>
        // –ü–∞—Ä–æ–ª—å —Ä–∞–∑—Ä–∞–±–æ—Ç—á–∏–∫–∞
        const DEVELOPER_PASSWORD = "AlphaWolf2024!";
        
        // –ì–µ–Ω–µ—Ä–∞—Ç–æ—Ä –∫–æ–¥–æ–≤
        function generateAccessCode() {
            const chars = 'ABCDEFGHJKLMNPQRSTUVWXYZ23456789';
            let code = '';
            for (let i = 0; i < 8; i++) {
                code += chars.charAt(Math.floor(Math.random() * chars.length));
            }
            return 'MS' + code;
        }

        // –ë–∞–∑–∞ –¥–∞–Ω–Ω—ã—Ö –≤ localStorage
        function initDatabase() {
            if (!localStorage.getItem('meshUsers')) {
                const users = {};
                
                // –ì–µ–Ω–µ—Ä–∏—Ä—É–µ–º 30 —Å–ª—É—á–∞–π–Ω—ã—Ö –∫–æ–¥–æ–≤
                for (let i = 0; i < 30; i++) {
                    const code = generateAccessCode();
                    users[code] = { 
                        name: `–ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å ${i+1}`, 
                        role: 'user', 
                        usedAnswers: 0, 
                        lastSeen: new Date().toLocaleString(),
                        isActive: true
                    };
                }
                
                localStorage.setItem('meshUsers', JSON.stringify(users));
            }
            
            if (!localStorage.getItem('meshSettings')) {
                localStorage.setItem('meshSettings', JSON.stringify({
                    darkTheme: false,
                    fontSize: 16,
                    buttonPadding: 15,
                    themeColor: 'default',
                    notifications: true
                }));
            }
        }

        let currentUser = null;

        function showScreen(screenId) {
            document.querySelectorAll('.screen').forEach(screen => {
                screen.classList.remove('active');
            });
            document.getElementById(screenId).classList.add('active');
        }

        function adminLogin() {
            const password = prompt('–í–≤–µ–¥–∏—Ç–µ –ø–∞—Ä–æ–ª—å —Ä–∞–∑—Ä–∞–±–æ—Ç—á–∏–∫–∞:');
            if (password === DEVELOPER_PASSWORD) {
                currentUser = { 
                    name: '–†–∞–∑—Ä–∞–±–æ—Ç—á–∏–∫', 
                    role: 'developer', 
                    usedAnswers: 0, 
                    code: 'developer'
                };
                showScreen('adminPanel');
                updateAdminPanel();
            } else {
                alert('–ù–µ–≤–µ—Ä–Ω—ã–π –ø–∞—Ä–æ–ª—å!');
            }
        }

        function changeDeveloperPassword() {
            const newPassword = prompt('–í–≤–µ–¥–∏—Ç–µ –Ω–æ–≤—ã–π –ø–∞—Ä–æ–ª—å —Ä–∞–∑—Ä–∞–±–æ—Ç—á–∏–∫–∞:');
            if (newPassword && newPassword.length >= 6) {
                alert('–ü–∞—Ä–æ–ª—å –∏–∑–º–µ–Ω–µ–Ω! –ù–æ–≤—ã–π –ø–∞—Ä–æ–ª—å: ' + newPassword);
            } else {
                alert('–ü–∞—Ä–æ–ª—å –¥–æ–ª–∂–µ–Ω –±—ã—Ç—å –Ω–µ –º–µ–Ω–µ–µ 6 —Å–∏–º–≤–æ–ª–æ–≤!');
            }
        }

        function login() {
            const code = document.getElementById('codeInput').value.trim().toUpperCase();
            loginWithCode(code);
        }

        function loginWithCode(code) {
            const users = JSON.parse(localStorage.getItem('meshUsers'));
            
            if (users[code] && users[code].isActive !== false) {
                currentUser = users[code];
                currentUser.code = code;
                currentUser.lastSeen = new Date().toLocaleString();
                
                users[code] = currentUser;
                localStorage.setItem('meshUsers', JSON.stringify(users));
                
                document.getElementById('userInfo').innerHTML = 
                    `–ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å: ${currentUser.name}<br>–†–æ–ª—å: ${currentUser.role}`;
                
                updateProfileInfo();
                showScreen('mainApp');
                
            } else {
                alert('–ù–µ–≤–µ—Ä–Ω—ã–π –∫–æ–¥ –¥–æ—Å—Ç—É–ø–∞ –∏–ª–∏ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –∑–∞–±–ª–æ–∫–∏—Ä–æ–≤–∞–Ω!');
            }
        }

        function sendMessage() {
            const messageInput = document.getElementById('messageInput');
            const message = messageInput.value.trim();
            const chatContainer = document.getElementById('chatContainer');
            
            if (message === '') return;
            
            const userMessage = document.createElement('div');
            userMessage.className = 'message user-message';
            userMessage.innerHTML = `<strong>–í—ã:</strong> ${message}`;
            chatContainer.appendChild(userMessage);
            
            setTimeout(() => {
                const aiMessage = document.createElement('div');
                aiMessage.className = 'message ai-message';
                
                if (message.includes('–º–µ—à') || message.includes('–º—ç—à') || message.includes('cdo') || message.includes('http')) {
                    currentUser.usedAnswers++;
                    
                    aiMessage.innerHTML = `<strong>AI:</strong> ‚úÖ –ù–∞—à–µ–ª –æ—Ç–≤–µ—Ç—ã –≤ –∑–∞–¥–∞–Ω–∏–∏! –û—Ç–ø—Ä–∞–≤–ª—è—é —Ä–µ—à–µ–Ω–∏—è...<br>
                                          <small>–ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–æ –æ—Ç–≤–µ—Ç–æ–≤: ${currentUser.usedAnswers}${currentUser.role === 'premium' || currentUser.role === 'developer' ? '/‚àû' : '/4'}</small>`;
                    
                    if (currentUser.usedAnswers >= 4 && currentUser.role === 'user') {
                        const limitMessage = document.createElement('div');
                        limitMessage.className = 'message';
                        limitMessage.innerHTML = `<strong>‚ö†Ô∏è –õ–∏–º–∏—Ç –∏—Å—á–µ—Ä–ø–∞–Ω!</strong> –î–ª—è –ø—Ä–æ–¥–æ–ª–∂–µ–Ω–∏—è –Ω—É–∂–µ–Ω –ø—Ä–µ–º–∏—É–º.`;
                        chatContainer.appendChild(limitMessage);
                    }
                } else {
                    aiMessage.innerHTML = `<strong>AI:</strong> –ü—Ä–∏—à–ª–∏—Ç–µ —Å—Å—ã–ª–∫—É –Ω–∞ –∑–∞–¥–∞–Ω–∏–µ –∏–∑ –ú–≠–®/–¶–î–ó –¥–ª—è –ø–æ–∏—Å–∫–∞ –æ—Ç–≤–µ—Ç–æ–≤`;
                }
                
                chatContainer.appendChild(aiMessage);
                chatContainer.scrollTop = chatContainer.scrollHeight;
                
                updateUserData();
                updateProfileInfo();
            }, 1000);
            
            messageInput.value = '';
            chatContainer.scrollTop = chatContainer.scrollHeight;
        }

        function updateProfileInfo() {
            document.getElementById('profileInfo').innerHTML = `
                <strong>ID:</strong> ${currentUser.code}<br>
                <strong>–ò–º—è:</strong> ${currentUser.name}<br>
                <strong>–†–æ–ª—å:</strong> ${currentUser.role}<br>
                <strong>–ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–æ –æ—Ç–≤–µ—Ç–æ–≤:</strong> ${currentUser.usedAnswers}${currentUser.role === 'premium' || currentUser.role === 'developer' ? '/‚àû' : '/4'}<br>
                <strong>–ü–æ—Å–ª–µ–¥–Ω–∏–π –≤—Ö–æ–¥:</strong> ${currentUser.lastSeen}<br>
                <strong>–°—Ç–∞—Ç—É—Å:</strong> ${currentUser.usedAnswers >= 4 && currentUser.role === 'user' ? '–õ–ò–ú–ò–¢' : '–ê–ö–¢–ò–í–ï–ù'}
            `;
        }

        function updateAdminPanel() {
            const users = JSON.parse(localStorage.getItem('meshUsers'));
            const userList = document.getElementById('userList');
            const secretCodes = document.getElementById('secretCodes');
            
            userList.innerHTML = '';
            secretCodes.innerHTML = '';
            
            let totalAnswers = 0;
            let activeUsers = 0;
            
            Object.entries(users).forEach(([code, user]) => {
                if (user.isActive !== false) {
                    totalAnswers += user.usedAnswers;
                    if (user.lastSeen) activeUsers++;
                    
                    const codeItem = document.createElement('div');
                    codeItem.style.padding = '5px 0';
                    codeItem.style.borderBottom = '1px solid #ddd';
                    codeItem.innerHTML = `<strong>${code}</strong> - ${user.name} (${user.usedAnswers} –æ—Ç–≤–µ—Ç–æ–≤)`;
                    secretCodes.appendChild(codeItem);
                    
                    const userItem = document.createElement('div');
                    userItem.className = 'user-item';
                    userItem.innerHTML = `
                        <div>
                            <strong>${user.name}</strong><br>
                            <small>${code} | ${user.role}</small>
                        </div>
                        <div>
                            <small>–û—Ç–≤–µ—Ç–æ–≤: ${user.usedAnswers}</small>
                        </div>
                    `;
                    userList.appendChild(userItem);
                }
            });
            
            document.getElementById('totalUsers').textContent = Object.keys(users).length;
            document.getElementById('onlineUsers').textContent = activeUsers;
            document.getElementById('totalAnswers').textContent = totalAnswers;
        }

        function generateNewCodes() {
            const users = JSON.parse(localStorage.getItem('meshUsers'));
            const count = parseInt(prompt('–°–∫–æ–ª—å–∫–æ –∫–æ–¥–æ–≤ —Å–≥–µ–Ω–µ—Ä–∏—Ä–æ–≤–∞—Ç—å?', '10'));
            
            if (count && count > 0) {
                for (let i = 0; i < count; i++) {
                    const code = generateAccessCode();
                    users[code] = { 
                        name: `–ù–æ–≤—ã–π –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å`, 
                        role: 'user', 
                        usedAnswers: 0, 
                        lastSeen: null,
                        isActive: true
                    };
                }
                localStorage.setItem('meshUsers', JSON.stringify(users));
                updateAdminPanel();
                alert(`–°–≥–µ–Ω–µ—Ä–∏—Ä–æ–≤–∞–Ω–æ ${count} –Ω–æ–≤—ã—Ö –∫–æ–¥–æ–≤!`);
            }
        }

        function givePremium() {
            const code = prompt('–í–≤–µ–¥–∏—Ç–µ –∫–æ–¥ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è –¥–ª—è –≤—ã–¥–∞—á–∏ –ø—Ä–µ–º–∏—É–º–∞:');
            if (code) {
                const users = JSON.parse(localStorage.getItem('meshUsers'));
                if (users[code]) {
                    users[code].role = 'premium';
                    localStorage.setItem('meshUsers', JSON.stringify(users));
                    alert('–ü—Ä–µ–º–∏—É–º –¥–æ—Å—Ç—É–ø –≤—ã–¥–∞–Ω!');
                    updateAdminPanel();
                } else {
                    alert('–ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –Ω–µ –Ω–∞–π–¥–µ–Ω!');
                }
            }
        }

        function toggleDarkTheme() {
            const toggle = document.getElementById('darkThemeToggle');
            const settings = JSON.parse(localStorage.getItem('meshSettings'));
            settings.darkTheme = toggle.checked;
            localStorage.setItem('meshSettings', JSON.stringify(settings));
            
            document.body.classList.remove('dark-theme', 'blue-theme', 'green-theme', 'red-theme');
            
            if (toggle.checked) {
                document.body.classList.add('dark-theme');
            }
            
            applyThemeColor(settings.themeColor);
        }

        function changeFontSize(size) {
            const settings = JSON.parse(localStorage.getItem('meshSettings'));
            settings.fontSize = parseInt(size);
            localStorage.setItem('meshSettings', JSON.stringify(settings));
            
            document.documentElement.style.setProperty('--button-size', size + 'px');
            
            const sizeText = size < 16 ? '–ú–∞–ª–µ–Ω—å–∫–∏–π' : size > 18 ? '–ë–æ–ª—å—à–æ–π' : '–°—Ä–µ–¥–Ω–∏–π';
            document.getElementById('fontSizeValue').textContent = `${sizeText} (${size}px)`;
        }

        function changeButtonPadding(size) {
            const settings = JSON.parse(localStorage.getItem('meshSettings'));
            settings.buttonPadding = parseInt(size);
            localStorage.setItem('meshSettings', JSON.stringify(settings));
            
            document.documentElement.style.setProperty('--button-padding', size + 'px');
            
            const sizeText = size < 14 ? '–ö–æ–º–ø–∞–∫—Ç–Ω—ã–π' : size > 16 ? '–ë–æ–ª—å—à–æ–π' : '–°—Ç–∞–Ω–¥–∞—Ä—Ç–Ω—ã–π';
            document.getElementById('buttonPaddingValue').textContent = `${sizeText} (${size}px)`;
        }

        function changeThemeColor(color) {
            const settings = JSON.parse(localStorage.getItem('meshSettings'));
            settings.themeColor = color;
            localStorage.setItem('meshSettings', JSON.stringify(settings));
            
            applyThemeColor(color);
        }

        function applyThemeColor(color) {
            document.body.classList.remove('blue-theme', 'green-theme', 'red-theme');
            
            if (color !== 'default') {
                document.body.classList.add(color + '-theme');
            }
        }

        function toggleNotifications() {
            const toggle = document.getElementById('notificationsToggle');
            const settings = JSON.parse(localStorage.getItem('meshSettings'));
            settings.notifications = toggle.checked;
            localStorage.setItem('meshSettings', JSON.stringify(settings));
            
            if (toggle.checked) {
                showNotification('–£–≤–µ–¥–æ–º–ª–µ–Ω–∏—è –≤–∫–ª—é—á–µ–Ω—ã üîî');
            }
        }

        function showNotification(message) {
            if (Notification.permission === 'granted') {
                new Notification('Mesh Solver', { body: message });
            }
        }

        function loadSettings() {
            const settings = JSON.parse(localStorage.getItem('meshSettings'));
            if (settings) {
                document.getElementById('darkThemeToggle').checked = settings.darkTheme;
                if (settings.darkTheme) {
                    document.body.classList.add('dark-theme');
                }
                
                document.getElementById('fontSizeSlider').value = settings.fontSize;
                changeFontSize(settings.fontSize);
                
                document.getElementById('buttonPaddingSlider').value = settings.buttonPadding;
                changeButtonPadding(settings.buttonPadding);
                
                document.getElementById('themeColorSelect').value = settings.themeColor;
                applyThemeColor(settings.themeColor);
                
                document.getElementById('notificationsToggle').checked = settings.notifications;
            }
        }

        function updateUserData() {
            if (currentUser && currentUser.code !== 'developer') {
                const users = JSON.parse(localStorage.getItem('meshUsers'));
                users[currentUser.code] = currentUser;
                localStorage.setItem('meshUsers', JSON.stringify(users));
            }
        }

        function logout() {
            currentUser = null;
            document.getElementById('chatContainer').innerHTML = 
                '<div class="message ai-message"><strong>AI:</strong> –ü—Ä–∏–≤–µ—Ç! –ü—Ä–∏—à–ª–∏ —Å—Å—ã–ª–∫—É –Ω–∞ –∑–∞–¥–∞–Ω–∏–µ –∏–∑ –ú–≠–®/–¶–î–ó –∏ —è –Ω–∞–π–¥—É –æ—Ç–≤–µ—Ç—ã!</div>';
            showScreen('welcomeScreen');
        }

        document.addEventListener('DOMContentLoaded', function() {
            initDatabase();
            loadSettings();
            
            if ('Notification' in window && Notification.permission === 'default') {
                Notification.requestPermission();
            }
            
            document.getElementById('messageInput').addEventListener('keypress', function(e) {
                if (e.key === 'Enter') {
                    sendMessage();
                }
            });
            
            document.getElementById('codeInput').addEventListener('keypress', function(e) {
                if (e.key === 'Enter') {
                    login();
                }
            });
        });
    </script>
</body>
</html>
